# Copyright 2024 Google LLC

# Licensed under the Apache License, Version 2.0 (the "License");
# ... (rest of the license)

steps:
  - name: maven:3-eclipse-temurin-17-alpine
    entrypoint: mvn
    args: ["test"]
  - name: maven:3-eclipse-temurin-17-alpine
    entrypoint: mvn
    args: ["package", "-Dmaven.test.skip=true"]
  - name: gcr.io/cloud-builders/docker
    args: ["build", "-t", "us-central1-docker.pkg.dev/bqutil-test/anti-pattern/recognizer:0.1.1-SNAPSHOT", "--build-arg=JAR_FILE=target/recognizer:0.1.1.jar", "."]
images: ["us-central1-docker.pkg.dev/bqutil-test/anti-pattern/recognizer:0.1.1-SNAPSHOT"]

# - name: 'gcr.io/google.com/cloudsdktool/cloud-sdk'
#   entrypoint: 'gcloud'
#   args:
#     - 'run'
#     - 'deploy'
#     - 'recognizer'  # Cloud Run service name
#     - '--image'
#     - 'us-central1-docker.pkg.dev/bqutil-test/anti-pattern/recognizer:0.1.1-SNAPSHOT'  
#     - '--region'
#     - 'us-central1'
#     - '--platform'
#     - 'managed'
#     - '--no-allow-unauthenticated' # Or configure authentication as needed
