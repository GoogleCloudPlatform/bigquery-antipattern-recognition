id,recommendation,optimized_sql
/usr/local/google/home/whaite/dev/bigquery-antipattern-tool/bigquery-antipattern-recognition/samples/queries/input/multipleCTEs.sql,"CTEsEvalMultipleTimes: CTE with multiple references: alias a defined at line 1 is referenced 2 times.","CREATE TEMP TABLE A AS
SELECT
  reference_bases,
  start_position,
  COUNT(1) ct
FROM
  `bigquery-public-data.human_genome_variants.1000_genomes_phase_3_optimized_schema_variants_20150220`
WHERE
  reference_bases IN ('AT', 'TA', 'AT')
GROUP BY
  1, 2;
WITH B AS (
  SELECT
    reference_bases,
    COUNT(1) ct
  FROM
    A
  GROUP BY
    1
)
SELECT
  A.*,
  A.ct / B.ct
FROM
  A
JOIN
  B ON B.reference_bases = A.reference_bases;"
